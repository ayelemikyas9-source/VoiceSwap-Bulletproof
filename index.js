require('dotenv').config(); const express = require('express'); const { WebSocketServer, WebSocket } = require('ws'); const http = require('http'); const cors = require('cors'); const twilioService = require('./twilio-service'); const sessionManager = require('./session-manager'); const { STTService } = require('./stt-service'); const { ElevenLabsTTSService } = require('./elevenlabs-tts'); const { base64MulawToPCM16, pcm16ToBase64Mulaw } = require('./audio-utils'); const TwilioStreamThrottler = require('./twilio-stream-throttler'); const observability = require('./observability'); const app = express(); app.use(cors()); app.use(express.json()); app.use(express.urlencoded({ extended: true })); app.use(express.static('public')); const server = http.createServer(app); const wss = new WebSocketServer({ noServer: true }); app.get('/', (req, res) => { res.send('VoiceSwap Server is Running!'); }); app.post('/api/call', async (req, res) => { const { toNumber, voiceId, sessionId } = req.body; try { const callSid = await twilioService.makeCall(toNumber, voiceId, process.env.BASE_URL, sessionId); res.json({ callSid }); } catch (error) { res.status(500).json({ error: error.message }); } }); const PORT = process.env.PORT || 5000; server.listen(PORT, () => { console.log('Server running'); });
